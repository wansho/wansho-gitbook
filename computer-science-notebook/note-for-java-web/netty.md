# Netty

[TOC]



## 简介

Netty 是一个网络通信库！

Netty提供异步的、[事件驱动](https://baike.baidu.com/item/事件驱动/9597519)的网络应用程序框架和工具，用以快速开发高性能、高可靠性的[网络服务器](https://baike.baidu.com/item/网络服务器/99096)和客户端程序。

Netty 主要针对在 TCP 协议下，面向 Client 端的高并发应用，或者 Peer-to-Peer 场景下的大量数据持续传输的应用。

Netty 本质上是一个 NIO（New IO）框架，适用于服务器通信相关的多种应用场景。

要彻底理解 Netty，要先学习 NIO。

Netty 的核心贡献者，是一位韩国人。

![1658751361592](image/netty/1658751361592.png)



### 异步

| 同步(向服务器发起请求后，等待响应)                           | 异步(向服务器发起请求后，就干其他事情，响应后就执行回调)     |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| ![image-20220725191001914](assets/image-20220725191001914.png) | ![image-20220725191243728](assets/image-20220725191243728.png) |



### 事件驱动

类似于浏览器的点击事件。

服务端也是基于事件进行响应的，例如客户端的连接事件，断开事件。



### 应用场景

* 分布式系统中，各个节点之间的需要远程服务调用，高性能的 RPC 框架必不可少。Netty 作为异步高性能的通信框架，往往作为基础通信组件被这些 RPC 框架使用。
  例如：阿里的 RPC 框架 Dubbo 默认使用 Netty 作为基础通信组件，用于实现各进程节点之间的内部通信。
* 游戏行业，Netty 作为高性能的基础通信组件，提供了 TCP/UDP 和 HTTP 协议栈，方便定制和开发私有协议栈。



### Dubbo 和 Netty 的关系

Dubbo 是一款 RPC 框架，其底层默认使用 Netty 作为基础通信组件。



### 学习资料

* Netty in Action
* Netty 权威指南



## Java 网络 IO 模型



### BIO

Blocking IO 同步且阻塞（传统阻塞型）

服务器实现模式为一个连接一个线程，即客户端有连接时服务器端就需要启动一个线程进行处理，如果这个连接不做任何事情就会造成不必要的线程开销（可以通过线程池机制改善）。

使用场景：连接请求较少，架构固定，多服务器资源要求很高 ，JDK1.4 以前的唯一选择，但是程序简单容易理解。

相关类和接口在 java.io 中。



![image-20220726203557035](assets/image-20220726203557035.png)



### NIO

No Blocking IO 同步非阻塞（多路复用）。

服务器实现模式为一个线程处理多个请求（连接）。即客户端发送的请求都会注册到多路复用器上，多路复用器轮询到连接有 IO 请求就进行处理。

理论依据：客户端连接到服务端后，并不是一直都在读写数据，这样就没有充分利用线程这个资源，造成浪费。

使用场景：连接请求多并且连接比较短的架构，例如聊天服务器，弹幕系统，服务器间通讯。编程较复杂，JDK1.4 开始支持。

![image-20220726203933765](assets/image-20220726203933765.png)



### AIO(NIO2)

异步非阻塞。

使用场景：连接数目多且长链接比较多。比如文件服务器，充分调用 OS 参与并发操作，编程比较复杂，JDK7 开始支持。



