# Architect

[TOC]

## 数据库相关

### 业务相关

* 不要用外键
* 任何表都需要设置 ID 主键
* 所有业务相关的数据，不能直接删除，因为后面不知道啥时候还会用到，可以设置一个删除标志位

### MySQL 服务器硬件选型

* MySQL 不支持多核同时运算一条 sql
* CPU 选择原则
  * 对于高并发的场景，CPU 的核心数比频率更重要
  * 对于计算密集型场景，CPU 频率比核心数更重要
* 内存选择原则
  * InnoDB 引擎会将索引和数据缓存到内存中，速度很快，理想的选择是服务器内存大于数据总量
* 硬盘选择原则
  * 优先用 SSD 固态硬盘

### 列数据库

应用场景：批量处理、超大规模即时查询（适用于高查询场景，不适合高增删改场景）

列式存储数据库：HBase, Cassandra(卡三桌)

对于传统的行数据库来说，数据是按照行进行分散存储的，在读取数据的时候，磁盘要去寻找匹配的行，从而产生多次 IO，而列数据库的数据是连续存储的，IO 消耗很小。

| 行数据库存储                                                 | 列数据库存储                                                 |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| ![image-20210923195912024](assets/image-20210923195912024.png) | ![image-20210923195831697](assets/image-20210923195831697.png) |

Cassandra 官方宣称其速度比 MySQL 快 100 倍。

**列数据库速度快的原因**：

* 不读取无效数据

  <img align="left" src="assets/image-20210923200225125.png" alt="image-20210923200225125" style="zoom:50%;" />

* 数据压缩比大

  数据相关性大，连续存储的数据，类型都是一样的，可以采用一些算法进行压缩

**列式数据库遗留问题**

* 如何高效新增 —> 多个列族，并发写磁盘
* 如何高效更新 —> Cansandra 添加一个新版本号的数据
* 如何高效删除 —> 添加删除标记 keyType=Delete（逻辑删除）

## 时区问题

* UTC 世界时间

  世界时间比格林威治时间准，使用原子钟。

  UTC+8就是国际时加八小时,是东八区时间,是北京时间。

* GMT 格林威治时间

时间解释：`2018-01-31T14:32:19Z`

T代表后面跟着是时间，Z代表0时区（相差北京时间8小时）

2021-09-27T10:45:15.343Z 表示世界时间，其中 343 是毫秒 1s = 1000ms

